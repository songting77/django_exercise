# 页面复用之包含

1 使用到的关键字

{%include '你要包含的页面'%}

2 编写代码过程

~~~
准备一些HTML页面 比如head.html content.html

在你自己的页面将上边的页面包含进去就OK了 代码如下
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<p>我的劳动果实</p>
    {%include "head.html"%}
    {%include 'content.html'%}
</body>
</html>
~~~

# 自定义404页面

## 1 在模板文件夹下新建一个叫404.html的页面

## 2 在settings.py 里关掉DEBUG

~~~
DEBUG=FALSE
~~~



# request对象

服务器在接收到Http请求后，会根据报文创建HttpRequest对象

视图中的第一个参数就是HttpRequest对象

Django框架会进行自己的包装，之后传递给视图

属性:  path  请求的完整路径

  method  请求的方法，常用GET,POST  

  encoding  编码方式，常用utf-8

  GET  类似字典的参数，包含了get的所有参数

  POST  类似字典的参数，包含了post所有参数

  FILES  类似字典的参数，包含了上传的文件

  COOKIES  字典，包含了所有COOKIE

  session  类似字典，表示会话  

方法: is_ajax()  判断是否是ajax()，通常用在移动端和JS中

# response对象



## 状态码

status_code

## 	write和content的区别

​		write 追加写入

​		content 直接覆盖

使用实例

~~~
def response_index(req):
    response = HttpResponse()
    response.content = "我是content设置的"
    response.write("我是write写的")
    response.content = "素质是有的 就是有点低"
    response.flush()
    response.status_code = 404
    return response
~~~

## 加载静态资源

1 在工程目录下新建一个static目录

​	在该目录下 做自己的项目结构（新建对应的文件夹 比如css js等文件夹）

2 将对应的资源放入到对应的文件夹下 比如js文件 全都放入对应的js文件夹

3 修改settings.py文件

~~~
STATICFILES_DIRS = [
    os.path.join(BASE_DIR, 'static')
]
~~~

4 前端引用

~~~
{%load static%}
引入css
<link rel="stylesheet" href="{%static '你css的文件路径'%}">
示例如下
<link rel="stylesheet" href="{%static '2048/css/style.css'%}">

引入js
<script src="{%static '你的js路径'%}"></script>
示例如下
<script src="{%static '2048/js/bind_polyfill.js'%}"></script>
~~~

# cookie

## 	是什么

​			浏览器端的会话技术 可以在浏览器端保存一些数据（你想让浏览器帮你记录）

## 	怎么用

### 			设置cookie

~~~
	    response = HttpResponse()
        # 设置cookie
        response.set_cookie('u_name', name, max_age=5)
        # max_age 是过期时间 单位是秒
        # max_age 设置为 0 浏览器关闭失效
	    # 设置为None永不过期
	    # expires=timedelta(days=10) 10天后过期

~~~

### 		读取cookie

~~~
		# 拿cookie里面的值
    	u_name = req.COOKIES.get("u_name")
~~~

### 		删除cookie:delete_cookie

~~~
def my_logout(req):
    # 重定向到首页
    response = HttpResponseRedirect("/t5/myindex")
    # 删除u_name对应的cookie
    response.delete_cookie('u_name')
    return response
~~~



## 	不足：数据不安全 会将数据暴露出来

# session

## 	是什么

​			服务端的会话机制 基于cookie 把数据保存保存到了服务端

## 	怎么用

### 		设置

~~~
		# 设置session
        request.session['你的key'] = 你的值
~~~

### 		获取

~~~
	# 读取session
    my_seesion_data = req.session.get('你的key')
~~~



# 用户注册

​	1 先拿参数

​	2 校验参数格式和对应的用户名字要求

​	3 校验该用户是不是被注册过

​	4 如果没被注册就 创建一条用户数据

​	5 使用重定向将用户引导至登陆页 进行登录

代码

注意：create_user 用来创建用户

~~~
	    from django.contrib.auth.models import User
	    
	    params = req.POST
        u_name = params.get("u_name")
        pwd = params.get("pwd")
        confirm_pwd = params.get('confirm_pwd')
        # 判断用户的输入时候满足基本的要求
        if u_name and len(u_name)>3 and pwd and confirm_pwd and pwd == confirm_pwd:
            # 判断用户是否已经被注册了
            exists_flag = User.objects.filter(username=u_name).exists()
            if exists_flag:
                return HttpResponse("该用户被注册")
            else:
                # 如果没有被注册 那么就可以创建用户
                user = User.objects.create_user(username=u_name, password=pwd)
                return HttpResponse("创建了" + user.username)
        else:
            return HttpResponse("账号密码格式不正确")
~~~

# 登录

​	1 拿参数 账号 密码

​	2 校验数据格式 

​	3 校验用户 user = authenticate(username=u_name, password=pwd)

​	4 校验通过会得到用户 

​	5 将用户登录 login(req, user) 

​	6 如果校验用户失败 提示用户错误信息

~~~
		# 拿参数
        params = req.POST
        u_name = params.get("u_name")
        pwd = params.get("pwd")
        # 校验数据格式
        if u_name and len(u_name)>3 and pwd and len(pwd)>=3:
            # 校验用户
            user = authenticate(username=u_name, password=pwd)
            print(user)
            if user:
                # 通过校验的用户 让其登录
                login(req, user)
                return HttpResponse("ok")
            else:
                # 没通过的 返回错误
                return HttpResponse("账号或密码错误")
        else:
            return HttpResponse("请补全信息")
~~~

# 获取登录用户

~~~
user = request.user
~~~

# 退出

~~~
from django.contrib.auth import logout
logout(request)
~~~

